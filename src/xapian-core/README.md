
## how to install

```shell
# for dev
sudo dnf --disablerepo='*' --enablerepo=copr:copr.fedorainfracloud.org:ttys3:my-fedora-packages reinstall xapian-core xapian-core-devel xapian-core-libs

# for debug
sudo dnf --disablerepo='*' --enablerepo=copr:copr.fedorainfracloud.org:ttys3:my-fedora-packages reinstall xapian-core-debuginfo xapian-core-debugsource xapian-core-libs-debuginfo
```

## compile troubleshoot

```
checking whether g++ is a working C++ compiler... yes
./configure: line 18129: syntax error near unexpected token `17'
./configure: line 18129: `AX_CXX_COMPILE_STDCXX(17)'
```

```shell
sudo dnf install -y autoconf-archive
autoreconf -ifv
```

how to manual build:

```shell
/usr/bin/make -O -j10 V=1 VERBOSE=1

/usr/bin/make install DESTDIR=$(pwd)/result INSTALL="/usr/bin/install -p"
```


## notice

xapian header file path

1.5 is
```
/usr/include/xapian-1.5/xapian.h
/usr/include/xapian-1.5/xapian/*.h
```

1.4.x is
```
/usr/include/xapian.h
/usr/include/xapian/*.h
```

that is because:

in `xapian/xapian-core/configure.ac`

```shell
LIBRARY_VERSION_SUFFIX=
dnl Where xapian.h, etc go.
incdir=$includedir
case $PACKAGE_VERSION in
  [*.*[13579].*])
    dnl Development release series:
    [dev_series=`echo "$PACKAGE_VERSION"|sed 's/\.[^.]*$//'`]

    dnl Append version installed programs by default.  To specify no suffix,
    dnl configure with: --program-suffix=
    test x"$program_suffix" != xNONE || program_suffix=-$dev_series

    incdir=$incdir/xapian-$dev_series

    LIBRARY_VERSION_SUFFIX=-$dev_series
    ;;
esac

AC_SUBST([LIBRARY_VERSION_SUFFIX])
AC_SUBST([incdir])
```

so if the version is `1.5.x`, the middle version hit `[*.*[13579].*]`

include dir will change from `/usr/include` to `/usr/include/xapian-1.5`

`LIBRARY_VERSION_SUFFIX` will change from empty to `-1.5`

so we need to patch `xapian-core/configure.ac`

but this is not enough, due to https://github.com/xapian/xapian/commit/c7e4f8bcb739cec898cd9b888b40e4c3ddb097cd

we need to remove some other hardcoded `-1.5` suffix

## tar ball issue

doxgen version too old, has dynsections.js missing bug

Generated by Doxygen 1.8.13

Fedora 38 local is Generated by Doxygen 1.9.6

we can generate our self tar ball

```
git clone https://github.com/xapian/xapian
cd xapian
./bootstrap --download-tools=never xapian-core

sudo dnf builddep xapian-core-devel
sudo dnf install -y doxygen

./configure \
--enable-shared=yes \
--with-python3=no \
--with-python=no \
--with-php=no \
--with-ruby=no \
--with-tcl=no \
--with-csharp=no \
--with-java=no \
--with-perl=no \
--with-lua=no

cd xapian-core

# this must exec to run local newer doxygen to generate the new docs
make -j10

make dist-xz
```

## troubleshoot

https://src.fedoraproject.org/rpms/doxygen/blob/rawhide/f/doxygen.spec

https://www.doxygen.nl/manual/extsearch.html

```
 Problem: cannot install both xapian-core-libs-1.5.0_git3540-2.fc38.x86_64 from copr:copr.fedorainfracloud.org:ttys3:my-fedora-packages and xapian-core-libs-1.4.22-1.fc38.x86_64 from @System
  - package doxygen-2:1.9.6-7.fc38.x86_64 from @System requires libxapian.so.30()(64bit), but none of the providers can be installed
  - cannot install the best candidate for the job
  - problem with installed package doxygen-2:1.9.6-7.fc38.x86_64
```

